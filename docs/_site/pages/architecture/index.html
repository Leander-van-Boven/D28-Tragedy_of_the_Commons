<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.0.5 <https://hydejack.com/>
-->
















<head>
  






  
    

<title>Model Architecture | Tragedy of the Commons model Documentation</title>
<meta name="description" content="Everything there is to know about the implementation of this awesome project. All in one place.
">
<link rel="canonical" href="http://localhost:4000/D28-Tragedy_of_the_Commons/pages/architecture/">

  

  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Tragedy of the Commons model Documentation">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Tragedy of the Commons model Documentation">


  <meta name="theme-color" content="rgb(8,46,57)">


<meta name="generator" content="Hydejack v9.0.5" />


<link rel="alternate" href="http://localhost:4000/D28-Tragedy_of_the_Commons/404.html" hreflang="en">



<link rel="shortcut icon"    href="/D28-Tragedy_of_the_Commons/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/D28-Tragedy_of_the_Commons/assets/icons/icon-192x192.png">

<link rel="manifest" href="/D28-Tragedy_of_the_Commons/assets/site.webmanifest">





<link rel="preload" href="/D28-Tragedy_of_the_Commons/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">






<script>!function(e,t){"use strict";function n(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}e.loadJS=function(e,o){var r=t.createElement("script");r.src=e,o&&n(r,"load",o,{once:!0});var a=t.scripts[0];return a.parentNode.insertBefore(r,a),r},e._loaded=!1,e.loadJSDeferred=function(o,r){function a(){e._loaded=!0,r&&n(c,"load",r,{once:!0});var o=t.scripts[0];o.parentNode.insertBefore(c,o)}var c=t.createElement("script");return c.src=o,e._loaded?a():n(e,"load",a,{once:!0}),c},e.setRel=e.setRelStylesheet=function(e){function o(){this.rel="stylesheet"}n(t.getElementById(e),"load",o,{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/D28-Tragedy_of_the_Commons/';
  w._publicPath = '/D28-Tragedy_of_the_Commons/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
}(window);
</script>


<script async src="/D28-Tragedy_of_the_Commons/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script>


<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/D28-Tragedy_of_the_Commons/assets/css/hydejack-9.0.5.css" id="_stylePreload">
<link rel="stylesheet" href="/D28-Tragedy_of_the_Commons/assets/icomoon/style.css" id="_iconsPreload">




<!--<![endif]-->





</head>

<body class="no-break-layout">
  


<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/D28-Tragedy_of_the_Commons/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-page"
  role="main"
>
  <article class="page" role="article">
  <header>
    <h1 class="page-title">Model Architecture</h1>
    



  <div class="hr pb0"></div>


  </header>

  <ol title="Contents" id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#agent" id="markdown-toc-agent">Agent</a>    <ol>
      <li><a href="#agent-construction" id="markdown-toc-agent-construction">Agent construction</a></li>
      <li><a href="#agent-act" id="markdown-toc-agent-act">Agent act</a>        <ol>
          <li><a href="#base-energy-function" id="markdown-toc-base-energy-function">Base energy function</a></li>
          <li><a href="#restricted-energy-function-default" id="markdown-toc-restricted-energy-function-default">Restricted energy function (default)</a></li>
        </ol>
      </li>
      <li><a href="#agent-procreation" id="markdown-toc-agent-procreation">Agent procreation</a>        <ol>
          <li><a href="#svo-inheritance-from-either-parent-default" id="markdown-toc-svo-inheritance-from-either-parent-default">SVO inheritance from either parent (default)</a></li>
          <li><a href="#svo-inheritance-from-both-parents" id="markdown-toc-svo-inheritance-from-both-parents">SVO inheritance from both parents</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#resource" id="markdown-toc-resource">Resource</a>    <ol>
      <li><a href="#resource-pool-construction" id="markdown-toc-resource-pool-construction">Resource pool construction</a></li>
      <li><a href="#resource-consumption" id="markdown-toc-resource-consumption">Resource consumption</a></li>
      <li><a href="#resource-growth" id="markdown-toc-resource-growth">Resource growth</a></li>
      <li><a href="#growth-functions" id="markdown-toc-growth-functions">Growth functions</a>        <ol>
          <li><a href="#the-exponential-function" id="markdown-toc-the-exponential-function">The exponential function</a></li>
          <li><a href="#the-nth-root-function" id="markdown-toc-the-nth-root-function">The nth root function</a></li>
          <li><a href="#the-logarithmic-function-default" id="markdown-toc-the-logarithmic-function-default">The logarithmic function (default)</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#simulator" id="markdown-toc-simulator">Simulator</a>    <ol>
      <li><a href="#simulation-construction" id="markdown-toc-simulation-construction">Simulation construction</a></li>
      <li><a href="#simulation-loop" id="markdown-toc-simulation-loop">Simulation loop</a>        <ol>
          <li><a href="#initialisation" id="markdown-toc-initialisation">Initialisation</a></li>
          <li><a href="#the-epoch-loop" id="markdown-toc-the-epoch-loop">The epoch loop</a></li>
          <li><a href="#after-the-epoch-loop" id="markdown-toc-after-the-epoch-loop">After the epoch loop</a></li>
          <li><a href="#pseudocode" id="markdown-toc-pseudocode">Pseudocode</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#output" id="markdown-toc-output">Output</a>    <ol>
      <li><a href="#results-plotter" id="markdown-toc-results-plotter">Results plotter</a>        <ol>
          <li><a href="#resultsplotter-construction" id="markdown-toc-resultsplotter-construction">ResultsPlotter construction</a></li>
          <li><a href="#funcanimation" id="markdown-toc-funcanimation">FuncAnimation</a>            <ol>
              <li><a href="#def-update" id="markdown-toc-def-update">Def update</a></li>
              <li><a href="#blit" id="markdown-toc-blit">Blit</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#csv-logger" id="markdown-toc-csv-logger">CSV logger</a>        <ol>
          <li><a href="#csvlogger-construction" id="markdown-toc-csvlogger-construction">CsvLogger construction</a></li>
          <li><a href="#add-row" id="markdown-toc-add-row">Add row</a></li>
          <li><a href="#write" id="markdown-toc-write">Write</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#utilities" id="markdown-toc-utilities">Utilities</a></li>
</ol>

<h1 id="introduction">Introduction</h1>

<p>On this page, the structure and architecture of the implementation is explained. The simulation is built using the object-oriented programming paradigm, which means that each entity (agent, resource, etc.) is represented by a <code class="language-plaintext highlighter-rouge">class</code> containing all its values and behaviours. The files that are relevant to the implementation model are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D28-Tragedy_of_the_Commons/
├── cpr_simulation/
│   ├── __init__.py
│   ├── agent.py
│   ├── exception.py
│   ├── logger.py
│   ├── output.py
│   ├── parameters.py
│   ├── resource.py
│   ├── simulation.py
│   └── util.py
└── sim.py
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">__init__.py</code>: Module initiator file that determines that methods and attributes are exposed if <code class="language-plaintext highlighter-rouge">cpr_simluation</code> is imported as a module.</li>
  <li><code class="language-plaintext highlighter-rouge">agent.py</code>: Contains the <code class="language-plaintext highlighter-rouge">Agent</code> class, specifying the behaviour of each agent.</li>
  <li><code class="language-plaintext highlighter-rouge">exception.py</code>: Constains multiple custom exceptions that can be raised by <code class="language-plaintext highlighter-rouge">cpr_simulation</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">logger.py</code>: Contains the CSV logger logic.</li>
  <li><code class="language-plaintext highlighter-rouge">output.py</code>: Contains the real-time plotting logic.</li>
  <li><code class="language-plaintext highlighter-rouge">parameters.py</code>: Contains the default parameter dictionary. For more information, refer to <a href="/D28-Tragedy_of_the_Commons/pages/parameters/">Parameters</a>.</li>
  <li><code class="language-plaintext highlighter-rouge">resource.py</code>: Contains the <code class="language-plaintext highlighter-rouge">Resource</code> class, specifying the consumption and growth behavriour of the resource pool.</li>
  <li><code class="language-plaintext highlighter-rouge">simulation.py</code>: Contains the <code class="language-plaintext highlighter-rouge">Simulator</code> class, wherein the simulation is set up and run.</li>
  <li><code class="language-plaintext highlighter-rouge">util.py</code>: Contains some context-free helper methods.</li>
  <li><code class="language-plaintext highlighter-rouge">sim.py</code>: Contains the command-line interface and imports <code class="language-plaintext highlighter-rouge">cpr_simulation</code> to set-up and run a simulation. For more informatin about the command-line interface, refer to <a href="/D28-Tragedy_of_the_Commons/pages/interaction/">Interaction</a>.</li>
</ul>

<p>In the sections below, the <a href="#agent"><code class="language-plaintext highlighter-rouge">Agent</code></a>, <a href="#resource"><code class="language-plaintext highlighter-rouge">Resource</code></a> and <a href="#simulator"><code class="language-plaintext highlighter-rouge">Simulator</code></a> classes are more thoroughly explained. Thereafter a brief explanation of the <a href="#results-plotter"><code class="language-plaintext highlighter-rouge">ResultsPlotter</code></a> and <a href="#csv-logger"><code class="language-plaintext highlighter-rouge">CsvLogger</code></a> classes are given, finished by a short notice of the <a href="#utilities">utilities</a> created and used.</p>

<h1 id="agent">Agent</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Agent</span><span class="p">:</span>
    <span class="c1"># Attributes:
</span>    <span class="c1">#  - energy
</span>    <span class="c1">#  - social_value_orientation
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Class constructor
</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">from_svo_distribution</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">dist_params</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> 
                              <span class="n">agent_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
        <span class="c1"># Generate set of n agents with their SVO's 
</span>        <span class="c1"># sampled from a multi-modal normal 
</span>        <span class="c1"># distribution 
</span>
    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># Epoch behaviour entry point
</span>
    <span class="k">def</span> <span class="nf">base_energy_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># Base energy function behaviour
</span>
    <span class="k">def</span> <span class="nf">restricted_energy_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># Restricted energy function behaviour
</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">procreate</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">parents</span><span class="p">):</span>
        <span class="c1"># Procreation function
</span>
        <span class="k">def</span> <span class="nf">svo_either_parent</span><span class="p">():</span>
            <span class="c1"># SVO inheritance function based on
</span>            <span class="c1"># either parent
</span>
        <span class="k">def</span> <span class="nf">svo_both_parents</span><span class="p">():</span>
            <span class="c1"># SVO inheritance function based on
</span>            <span class="c1"># both parents
</span></code></pre></div></div>
<p class="figcaption">Because what would a common-pool resource be without any exploitants.</p>

<h2 id="agent-construction">Agent construction</h2>
<p>The constructor of <code class="language-plaintext highlighter-rouge">Agent</code>, <code class="language-plaintext highlighter-rouge">Agent.__init__()</code>, constructs a new instance of the <code class="language-plaintext highlighter-rouge">Agent</code> class. It fills all attributes based on the parameter dictionary <code class="language-plaintext highlighter-rouge">params</code>. In addition, the static method <code class="language-plaintext highlighter-rouge">Agent.from_svo_distribution()</code> can be used to make a collection of agents, with their social value orientation drawn from a multi-modal normal distribution.</p>

<p>In this method, the means and standard deviations are passed through the <code class="language-plaintext highlighter-rouge">dist_params</code> argument. However, instead of using this to make a single multi-modal normal distribution, we make multiple unimodal distributions. For each agent, we take one such distribution by chance, and sample its social value orientation from that. This is mathematically equivalent so sampling all agents from a multi-modal distribution.</p>

<p class="note">The initial SVO distribution can be altered through the <code class="language-plaintext highlighter-rouge">svo_dist</code> parameter. Refer to <a href="../parameters/#svo-distributions-parameters">Parameters</a> for more information.</p>

<h2 id="agent-act">Agent act</h2>
<p>The behaviour ‘act’, represented by the method <code class="language-plaintext highlighter-rouge">Agent.act()</code>, represents the behaviour of this agent for an entire epoch. In our model, the act comprises of two things:</p>
<ul>
  <li>Metabolise some energy (agent’s energy level decreases)</li>
  <li>Decide whether to go fishing (energy leven increases)</li>
</ul>

<p>How much energy the agent metabolises is decided by a parameter that’s constant across all agents.</p>

<p class="note">The agents’ fish consumption can be altered through the  <code class="language-plaintext highlighter-rouge">agent:metabolism</code> and <code class="language-plaintext highlighter-rouge">agent:consumption_factor</code> parameters. Refer to <a href="../parameters/#agent-specific-parameters">Parameters</a> for more information.</p>

<p>Whether to go fishing, and how much fish to catch, is decided by the <em>energy function</em>. The outcome of these functions relies solely on the agent’s social value orientation and the amount of resource that’s left. This model implements two such functions, which both are described in the sections below.</p>

<p class="note">The energy function used by the agents can be altered through the <code class="language-plaintext highlighter-rouge">agent:behaviour</code> parameter. Refer to <a href="../parameters/#agent-specific-parameters">Parameters</a> for more information.</p>

<h3 id="base-energy-function">Base energy function</h3>
<p>The base energy function, represented by the method <code class="language-plaintext highlighter-rouge">Agent.base_energy_function()</code>, is the initially proposed agent behaviour function. This functions is very naive in that it makes a black and white separation between pro-self and pro-social agents (&lt;.5 SVO means pro-self, &gt;=.5 SVO means pro-social). While pro-social agents will always fish their consumption, the consumption of the pro-self agents differs based on the available resources.<br />
Let \(A_p\subseteq A\) be the set of all pro-self agents as a subset of the set of all agents. Each agent \(a\in A_p\) has a predetermined and constant metabolism value, which we define here as \(m\). An agent consumes a little more than they need, which is why a predefined and constant consumption factor is added. Let us define this factor as \(c\).<br />
Say that the total amount of resource that’s available when agent goes fishing is denoted as \(f_a\). If the amount of resource that available fish for each agent falls below a certain threshold (denoted \(s\)), pro-self agents start behaving differently. Their behaviour can be defined as follows:</p>

\[\begin{array}{lr}c_a=
    \begin{cases}
        m\cdot c\cdot g\ &amp; \frac{f_a}{|A|}&lt;s\\
        m\cdot c &amp; \text{otherwise}
    \end{cases} &amp; \forall a\in A_p
\end{array}\]

<h3 id="restricted-energy-function-default">Restricted energy function (default)</h3>
<p>The restricted energy function, represented by the method <code class="language-plaintext highlighter-rouge">Agent.restricted_energy_function</code>(), builds on the base function by adding a epoch-based resource restriction.</p>

<p class="note">The point at which the restriction kicks in or out can be altered through the <code class="language-plaintext highlighter-rouge">simulation:res_limit_factor</code> and <code class="language-plaintext highlighter-rouge">simulation:res_unlimit_factor</code> parameters respectively. Refer to <a href="../parameters/#restricted-model-limit-parameters">Restricted model limit parameters</a> for more information.</p>

<p>If this restriction is active, agents are only allowed to fish if they would die otherwise. However, each agent has a chance of ignoring this restriction. The probability hereof is linearly dependent of the agent’s social value orientation, i.e. if they range more towards pro-selfness, they are inclined to ignore the restriction more often.<br />
However, agents that choose to ignore this rule have have a probability of being caught. If they are catched red-handed, they are punished and can’t fish for a predetermined number of epochs.</p>

<p class="note">The probability of an agent being caught and the amount of epochs they can’t fish if they are caught can be altered through the <code class="language-plaintext highlighter-rouge">agent:caught_chance</code> and <code class="language-plaintext highlighter-rouge">agent:caught_cooldown_factor</code> parameters respectively. Refer to <a href="../parameters/#agent-specific-parameters">Agent-specific parameters</a> for more information.</p>

<h2 id="agent-procreation">Agent procreation</h2>
<p>If agents have enough energy available, they can procreate. The procreation is implemented in the static method <code class="language-plaintext highlighter-rouge">Agent.procreate()</code>. Repeatedly, two random agents are taken from the list of parents and they procreate. Apart from the child’s social value orientation, all attributes remain constant. The child’s social value orientation is dynamic however, and is chosen depending on the parents’ social value orientations and energy levels. This model implements two social value orientation inheritance functions, which are described in the sections below.</p>

<p class="note">The social value orientation inheritance function can be altered through the <code class="language-plaintext highlighter-rouge">agent:svo_inheritance_function</code> parameter. Refer to <a href="../parameters/#general-agent-parameters">General agent parameters</a> for more information.</p>

<h3 id="svo-inheritance-from-either-parent-default">SVO inheritance from either parent (default)</h3>
<p>This function is represented by the local method <code class="language-plaintext highlighter-rouge">svo_either_parent()</code> that is located within <code class="language-plaintext highlighter-rouge">Agent.procreate()</code>. With this method, the child’s social value orientation is based on one of their parents. We first have to decide which parent to take, which is done probabilisticly based on the parents’ energy level:</p>

\[\begin{align}
P(\mu_c=svo_{p1}) &amp;= \frac{e_{p1}}{e_{p1}+e_{p2}}\\[2em]
P(\mu_c=svo_{p2}) &amp;= \frac{e_{p2}}{e_{p1}+e_{p2}}\\[2em]
&amp;=1-P(\mu_c=svo_{p1})
\end{align}\]

<p class="figcaption">The probabilities of the child’s mean svo to become that of both parents. Here, \(P(\phi )\) denotes the probability that \(\phi\).</p>

<p>Notice that \(\mu_c\) is used instead of \(svo_c\). This because the social value orientation of the child is drawn from a normal distribution with a predetermined standard deviation. Thus we get:</p>

\[\begin{array}{ll}svo_c = \max(\min(\alpha,1),\ 0) &amp; \alpha \sim \mathcal{N}(\mu_c, \sigma_c)\end{array}\]

<p>The social value orientation is drawn from a normal distribution. Here, \(\sigma_c\) denotes the predetermined standard deviation
{.figcaption}</p>

<p>The standard deviation for the final normal distribution can be altered through the <code class="language-plaintext highlighter-rouge">agent:svo_convergence_factor:svo_either_parent</code> parameter. Refer to <a href="../parameters/#general-agent-parameters">General agents parameters</a> for more information.</p>

<h3 id="svo-inheritance-from-both-parents">SVO inheritance from both parents</h3>
<p>This function is represented by the lcoal method <code class="language-plaintext highlighter-rouge">svo_both_parents()</code> that is located within <code class="language-plaintext highlighter-rouge">Agent.procreate()</code>. With this method, the child’s social value orientation is based on both parents. As before, we construct a normal distribution where the social value orientation is sampled from. However, in this case the mean \(\mu_c\) is determined by the weighted mean of the parents’ social value orientations:</p>

\[\mu_c=\frac{svo_{p1}\cdot e_{p1} + svo_{p2}\cdot e_{p2}}{e_{p1}+e_{p2}}\]

<p>So the mean social value orienation of the child lies somewhere between the social value orientations of its parents. The standard deviation depends on the actual distance of \(\mu_c\) from the parents’ social valure orientations:</p>

\[\sigma_c=\frac{1}{3}\cdot \min(\vert\mu_c, svo_{p1}\vert, \vert\mu_c, svo_{p2}\vert)\cdot t\]

<p>Put in words, the extremes of the normal distributions (\(\pm 3\sigma_c\)) are made so that it will not exceed the parents’ social value orientation. That is, if \(t\) is set to 1. This factor can thus be used to allow for some exploration in the social value orientation search space.</p>

<p class="note">The value of \(t\) can be altered through the <code class="language-plaintext highlighter-rouge">agent:svo_convergence_factor:svo_both_parents</code> parameter. Refer to <a href="../parameters/#general-agent-parameters">General agent parameters</a> for more information.</p>

<h1 id="resource">Resource</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
    <span class="c1"># Attributes:
</span>    <span class="c1"># - growth (unary function)
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># Resource pool constructor
</span>
    <span class="k">def</span> <span class="nf">growth_exponential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">rate</span><span class="p">):</span>
        <span class="c1"># Exponential growth function
</span>
    <span class="k">def</span> <span class="nf">growth_logarithmic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># logarithmic growth function
</span>
    <span class="k">def</span> <span class="nf">growth_nroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c1"># Nth root growth function
</span>
    <span class="k">def</span> <span class="nf">grow_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Resource growth function entry point
</span>
    <span class="k">def</span> <span class="nf">consume_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="c1"># Resource consumption entry pont
</span></code></pre></div></div>

<h2 id="resource-pool-construction">Resource pool construction</h2>
<p>The constructor of the <code class="language-plaintext highlighter-rouge">Resource</code>, <code class="language-plaintext highlighter-rouge">Resource.__init__()</code>, constructs a new instance of the <code class="language-plaintext highlighter-rouge">Resource</code> class. During construction, the attributes are set from the provided parameters. Assume the amount of resources that are available at epoch \(t\) is defined by \(r_t\). From the parameters, we set \(r_0\) equal to a predetermined value.<br />
In addition, the function (<code class="language-plaintext highlighter-rouge">Resource.growth_exponential</code>, <code class="language-plaintext highlighter-rouge">Resource.growth_logarithmic</code> or <code class="language-plaintext highlighter-rouge">Resource.growth_nroot</code>) that is used for the growth of the resource is also set from the parameters. We partially implement these functions already, filling the exponents (all function parameters but <code class="language-plaintext highlighter-rouge">val</code>). Therefore, after construction of the resource, a growth function that takes only one value <code class="language-plaintext highlighter-rouge">Resource.growth</code> is generated.<br />
Finally, the current amount of resources \(r_0\) are set to the provided start amount.</p>

<h2 id="resource-consumption">Resource consumption</h2>
<p>The resource class exposes a method <code class="language-plaintext highlighter-rouge">Resource.consume_resource()</code>, which attempts to take an amount (<code class="language-plaintext highlighter-rouge">amount</code>) of resource from the total amount of resource available. However, if less resources are left that this amount, the funtion will take whatever is left (taking into account the required minium amount of resources). This value is substracted from the amount of resources available (\(r_t\)) and is returned to the caller.</p>

<h2 id="resource-growth">Resource growth</h2>
<p>The <code class="language-plaintext highlighter-rouge">Resource.grow_resource</code> method can be called to grow the resource (\(r_{t+1}\leftarrow \text{growth}(r_t)\)). Naturally, this method is invoked once per epoch. The behaviour of this functin depends on the growth function that is chosen, as is more thoroughly explained in the next section.</p>

<h2 id="growth-functions">Growth functions</h2>
<p>In this section, the three available growth functions are explained.</p>

<p>The active resource growth function can be altered through the <code class="language-plaintext highlighter-rouge">resource:growth_function</code> parameter. Refer to <a href="../parameters/#resource-parameters">Resource Parameters</a>. See <a href="../interaction/#example-analyzing-resource-growth-functions">this example</a> on how to check the behaviour of a growth function without interference of agents.</p>

<h3 id="the-exponential-function">The exponential function</h3>
<p>The exponential resource growth function is defined as follows:</p>

\[\begin{align}
r_{t+1} &amp;= r_t + f(r_t)\\[2em]
f(x) &amp;= e\cdot x
\end{align}\]

<p>Note that this function in itself isn’t exponential. However, when it is repeatedly applied each epoch, it will be. This function has one parameter, \(e\), which determines the amount of exponential growth.</p>

<p class="note">The exponent \(e\) can be altered through the <code class="language-plaintext highlighter-rouge">resource:gf_params:exponential:rate</code> parameter. Refer to <a href="../parameters/#exponential-growth-function">Exponential growth function</a> for more information.</p>

<h3 id="the-nth-root-function">The nth root function</h3>

<p>The nth root function is defined as follows:</p>

\[\begin{align}
r_{t+1} &amp;= r_{t} + g(r_t)\\[2em]
g(x) &amp;= a\cdot\frac{1}{(x-\frac{t_x}{a})^\frac{1}{n}}-t_y
\end{align}\]

<p>The growth of the value of \(g(x)\) decreases as \(r_t\) increases. This allows for a radical resource growth at the start, but a more gradual resource growth if there is already a high amount of resources available. This function was designed to be resemble a ‘nested’ common-pool resource, where the lake is able to support but a limited amount of fish. The exponents \(a\), \(t_x\), \(t_y\) and \(n\) have the following implications to the behaviour of \(g(x)\):</p>

<ul>
  <li>\(a\): Scales the whole function. Scales any properties that are already existent in the function.If all other values are set, this is value can be used to alter the amount of resource growth.</li>
  <li>\(t_x\): Translation over the x axis. Alters the level of radicality in the beginning and the point at which the growth becomes more gradual.</li>
  <li>\(t_y\): Translation over the y acis. Alters the ‘base’ amount of resource growth.</li>
  <li>\(n\): Root base. This alters the speed at which the initial radicality changes to graduality. In a sense, this is the radicality redicality exponent.</li>
</ul>

<p class="note">If the level of radicality of the initial growth is set too high, then all agents can feed off of the initial resource jump (\(g(r_t)\) if \(r_t=1\)) as at this point the function is most radical. This behaviour can be recognized by a flat, straight line of resources in the real-time resource plot.</p>

<p class="note">The exponents \(a\), \(t_x\), \(t_y\) and \(n\)  can be altered through the <code class="language-plaintext highlighter-rouge">resource:gf_params:nroot:a</code>, <code class="language-plaintext highlighter-rouge">resource:gf_params:nroot:tx</code>, <code class="language-plaintext highlighter-rouge">resource:gf_params:nroot:ty</code> and <code class="language-plaintext highlighter-rouge">resource:gf_params:nroot:n</code> parameters, respectively. Refer to <a href="../parameters/#nth-root-growth-function">Nth root growth function</a> for more information.</p>

<h3 id="the-logarithmic-function-default">The logarithmic function (default)</h3>

<p>The logarithmic function is defined as follows:</p>

\[\begin{align}
r_{t+1} &amp;= r_{t} \cdot h(r_t)\\[2em]
h(x) &amp;= \frac{a}{\log(x)+\frac{a}{s-t}} + t
\end{align}\]

<p>This function was designed to account for the problem with the nth root function that agents can feed off of the initial jump, whilst keeping the radical-gradual pattern. In fact, as \(h(r_t)\) scales the value of \(r_t\) instead of adding up to it (as the previous two functions do), this growth function emits a gradual-redical-gradual resource growth pattern.</p>

<p class="note">For this function, a mimimum amount of 1 resource needs to always be available. This is because the behaviour of \(h(x)\) is undefined if \(x=0\). Always check that <code class="language-plaintext highlighter-rouge">resource:min_value</code> is set to 1 or higher if using the logarithmic growth function. Refer to <a href="../parameters/#resource-parameters">Resource Parameters</a> for more information.</p>

<p>The exponents \(a\), \(s\) and \(t\) have the following implications to the behaviour of \(h(x)\):</p>

<ul>
  <li>\(a\): Scales the whole function. Scales any properties that are already existent in the function.If all other values are set, this is value can be used to alter the amount of resource growth.</li>
  <li>\(s\): Initial scale factor. If \(r_t=1\), \(h(r_t)\) will be equal to \(s\). For all \(x&gt;1\), \(h(x)&lt;s\).</li>
  <li>\(t\): Translation over x axis (roughly). Alters the speed at which the value of the function goes down, thus modifying the speed of the gradual-radical-gradual pattern.</li>
</ul>

<p class="note">The exponents \(a\), \(s\) and \(t\) can be altered through the <code class="language-plaintext highlighter-rouge">resource:gf_params:logarithmic:a</code>, <code class="language-plaintext highlighter-rouge">resource:gf_params:logarithmic:t</code> and <code class="language-plaintext highlighter-rouge">resource:gf_params:logarithmic:t</code> parameters, respectively. Refer to <a href="../parameters/#logarithmic-growth-function">Logarithmic growth function</a> for more information.</p>

<h1 id="simulator">Simulator</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Simulator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">printer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                 <span class="n">row_head</span><span class="o">=</span><span class="p">[],</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c1"># Params and modules initializer
</span>    
    <span class="k">def</span> <span class="nf">get_agent_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_social_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_social_value</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Get amount of agents based on min and max SVO
</span>
    <span class="k">def</span> <span class="nf">add_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
        <span class="c1"># Adds an agent to the simulation
</span>    
    <span class="k">def</span> <span class="nf">remove_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
        <span class="c1"># Removes an agent from the simulation
</span>
    <span class="k">def</span> <span class="nf">generate_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initializes and runs the simulation
</span>
    <span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Updates the real-time plot
</span>
    <span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Updates the command-line output
</span>
    <span class="k">def</span> <span class="nf">log_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Updates the CSV logger
</span></code></pre></div></div>

<p>This class is the spine of the simulation, hence its name. Here is where the agents and fish live and where the actual results of the model are produced by controlling both the community of agents and the common resource.</p>

<h2 id="simulation-construction">Simulation construction</h2>
<p>The constructor of <code class="language-plaintext highlighter-rouge">Simulator</code>, <code class="language-plaintext highlighter-rouge">Simulator.__init__()</code>, constructs a new intance of the <code class="language-plaintext highlighter-rouge">Simulator</code> class. Not only will this class set the values of its own attributes and variables, it will also receive the parameters for both the <code class="language-plaintext highlighter-rouge">Agent</code> and <code class="language-plaintext highlighter-rouge">Resource</code> classes, of which it will instantiate instances. Here the <code class="language-plaintext highlighter-rouge">Simulator</code> class also receives a reference to a <code class="language-plaintext highlighter-rouge">ResultPlotter</code> or <code class="language-plaintext highlighter-rouge">CsvLogger</code> class if specified via the command-line and/or instatiated in <code class="language-plaintext highlighter-rouge">main.py</code>. 
Furthermore, the thresholds for activating and deactivating the resource restriction are calculated.</p>

<h2 id="simulation-loop">Simulation loop</h2>
<p class="note">The following subsections describe the workings of the main simulation loop, embedded in the <code class="language-plaintext highlighter-rouge">Simulator.generate_simulation()</code> function.</p>

<h3 id="initialisation">Initialisation</h3>
<p>Before the simulation goes into its simulation loop, the simulation is first initialised:</p>
<ul>
  <li>First the list of agents is initialised using the <a href="#agent-construction"><code class="language-plaintext highlighter-rouge">Agent.from_svo_distribution()</code></a> function.</li>
  <li>Then the resources are <a href="#resource-construction"><code class="language-plaintext highlighter-rouge">initialised</code></a>.</li>
  <li>The current statistics and epoch counter are reset.</li>
  <li>If required, the initial statistics are plotted, printed and logged.</li>
</ul>

<h3 id="the-epoch-loop">The epoch loop</h3>
<p>Once initialisation is complete, the epoch loop starts. This loop will run untill either of the stopping conditions are met. There are two different stopping conditions:</p>
<ol>
  <li>Either the maximum amount of epochs are reached; or</li>
  <li>The amount of alive agents drops under a certain threshold.
The first stopping condition can be specified by setting the <code class="language-plaintext highlighter-rouge">simulation:max_epoch</code> parameter. The second stopping condition is set to 2. This is done so since 1 agent will not be able to procreate, and will eventually die of age. It may however happen that all alive agents die all within the epoch, therefore we need to check whether \(|A|&lt;2\) (where \(A\) denotes the set of alive agents), instead of \(|A|=1\).</li>
</ol>

<p>During each loop a few things happen in the following order:</p>
<ol>
  <li>Before the body of the loop starts, the first stopping condition is checked. If this passes the body of the loop is executed.</li>
  <li>First the list of <em>parents</em> and <em>eol</em> (end of life) are reset.</li>
  <li>Then it is checked whether the resource restriction should be active or inactive.</li>
  <li>Then the list of alive agents is iterated through:
    <ol>
      <li>First the agent acts.</li>
      <li>Then the consequences of its actions are determined (below points are mutually exclusive):
        <ul>
          <li>If the agent has an energy of &lt;0 it is added to the <em>eol</em> list.</li>
          <li>If the agent has become to old it is added to the <em>eol</em> list.</li>
          <li>If the energy of the agent meets the procreate requirement it is added to the list of parents.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>All agents on the <em>eol</em> list are removed from the simulation.</li>
  <li>All agents on the <em>parents</em> list procreate, following the <a href="#agent-procreation">agent procreation</a> function.</li>
  <li>The resources <a href="#resource-growth">regrow</a>.</li>
  <li>The list of agents is shuffled, to minimize the chance that the same agent gets to act first each epoch.</li>
  <li>If required, the results are printed, plotted and/or logged.</li>
  <li>Finally if the second stopping condition passes, the epoch counter is increased by 1 and the loop restarts.</li>
</ol>

<h3 id="after-the-epoch-loop">After the epoch loop</h3>
<p>When the epoch loop has finished there are 3 possible states of the simulation:</p>
<ol>
  <li>The loop has finished due to epoch limit. This means that the simulation could’ve run longer and is therefore considered a success. The following result message is displayed: <code class="language-plaintext highlighter-rouge">"Maximum epoch reached, ..."</code>.</li>
  <li>The loop has finished due to agent count. The first possibility is that there is just one agent left. Such a simulation is considered a failure. Then the following result message is displayed: <code class="language-plaintext highlighter-rouge">"Only one lonely agent managed to survive. ..."</code>.</li>
  <li>The loop has finished due to agent count and there are no agents left. A simulation with such result is also considered to be a failure. In this case the following result message is displayed: <code class="language-plaintext highlighter-rouge">"All agents are dead :( ..."</code></li>
</ol>

<h3 id="pseudocode">Pseudocode</h3>
<p>See below for the pseudocode representing a graphical overview of aforementioned explanation of the <code class="language-plaintext highlighter-rouge">Simulator.generate_simulation()</code> method.</p>

<p><img src="/D28-Tragedy_of_the_Commons/assets/img/simulation_pseudo.png" alt="" /></p>

<h1 id="output">Output</h1>

<h2 id="results-plotter">Results plotter</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ResultsPlotter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_agent</span><span class="p">,</span> <span class="n">svo_bar_count</span><span class="p">,</span> <span class="n">start_resource</span><span class="p">,</span> <span class="n">fullscreen</span><span class="p">):</span>
        <span class="c1"># Sets up all parameters and attributes of the class
</span>    
    <span class="k">def</span> <span class="nf">init_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initializes the plot for the animation
</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Updates the plot from the data provided
</span>
    <span class="k">def</span> <span class="nf">start_printer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_gen</span><span class="p">):</span>
        <span class="c1"># Initializes the animation and shows the plot
</span>
    <span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

</code></pre></div></div>
<p>Plots always give a good and quick overview of whats going on with the data, and the model in this case. By having this plot real-time, the progress of a simulation can be viewed directly without after-the-fact data analysis. Runs that did not provide satisfying results can then easily be discarded, since only those that do need to be explicitly saved. Refer to the <a href="../output/#real-time-plot">real-time plot output</a> for a detailed explanation of the output of this class. This plot is intentionally kept minimal to keep plotting speed as high as possible. If more advanced plots are desired one should perform off-line data analysis using the data from the <a href="#csv-logger">CSV-logger</a>.</p>

<h3 id="resultsplotter-construction">ResultsPlotter construction</h3>
<p>The constructor of <code class="language-plaintext highlighter-rouge">ResultsPlotter</code>, <code class="language-plaintext highlighter-rouge">ResultsPlotter.__init__()</code>, constructs a new instance of the <code class="language-plaintext highlighter-rouge">ResultsPlotter</code> class. During construction the figure and its subplots are initialised; the correct plot titles and axis labels are set. Furthermore, the various lines and histogram bars are initialised with the correct colors, labels and styles.</p>

<h3 id="funcanimation">FuncAnimation</h3>
<p>The <code class="language-plaintext highlighter-rouge">ResultsPlotter</code> class uses the <a href="https://matplotlib.org/3.3.2/api/_as_gen/matplotlib.animation.FuncAnimation.html#matplotlib.animation.FuncAnimation"><code class="language-plaintext highlighter-rouge">FuncAnimation</code></a> class from the <code class="language-plaintext highlighter-rouge">animation</code> module of the <code class="language-plaintext highlighter-rouge">matplotlib</code> library. <code class="language-plaintext highlighter-rouge">FuncAnimation</code> works by repeatedly calling a function that yields the data to be plotted. Before the actual animation starts, an initialisation is called.
The animation initialisation is performed in the <code class="language-plaintext highlighter-rouge">init_plot()</code> method. Here all axis limits and data of the subplots are reset.</p>

<p class="note">One would expect to do the initialisation all in one method (either the <code class="language-plaintext highlighter-rouge">init_plot()</code> or <code class="language-plaintext highlighter-rouge">__init__()</code> function). However the <code class="language-plaintext highlighter-rouge">FuncAnimation</code> can be set to run repeatedly (so restart each time a previous simulation ends). Each repeat then will call the initialisation function, before starting the animation. Resetting all subplots and their labels, axis limits and styles would be redundant..</p>

<p>The animation is started in the <code class="language-plaintext highlighter-rouge">start_printer()</code> function. The initialisation function is called from this method and the animation is started using the provided data generator (a function yielding the data for the plot). Each time the data generator yields new results the <code class="language-plaintext highlighter-rouge">update()</code> function is called.</p>

<h4 id="def-update">Def update</h4>
<p>Each time the <code class="language-plaintext highlighter-rouge">update()</code> function is called, the plot will update using the newly provided data. This new data is contained in the tuple provided as argument. The  <code class="language-plaintext highlighter-rouge">update()</code> function will update the underlying arrays containing the data, adjust the axis limits if required and update the actual lines and histogram.</p>

<h4 id="blit">Blit</h4>
<p>One important argument of the <code class="language-plaintext highlighter-rouge">FuncAnimation</code> class to note is the <code class="language-plaintext highlighter-rouge">blit</code> argument. This argument changes the way the animation works internally. By settings this argument to <code class="language-plaintext highlighter-rouge">True</code> only the updated actors are drawn. Therefore the <code class="language-plaintext highlighter-rouge">init_plot()</code> and <code class="language-plaintext highlighter-rouge">update()</code> return the updated lines and histogram bars (which is not nessecary in normal plotting circumstances). This will make the plot significantly faster, since only a small part of each line is drawn each epoch. As a consequence however, the plot is reset when it is resized and when it reaches the end of the simulation.</p>

<p>Sufficient measures have been put in place to circumvent this consequence of faster plotting. For example, the <code class="language-plaintext highlighter-rouge">--resize</code> parameter can be provided. This will set the <code class="language-plaintext highlighter-rouge">blit</code> argument to <code class="language-plaintext highlighter-rouge">False</code>. This will however cause the plot to become significantly slower. Furthermore the plot will become gradually slower since each epoch the full length of the 4 lines need to be redrawn, which means that each epoch more data needs to be redrawn.<br />
Additionally the plot is automatically saved after the simulation, allowing the plot to be viewed even when it resets after the simulation. As a downside however, this image is saved in a fixed <code class="language-plaintext highlighter-rouge">.png</code> format therefore reducing the scalability of the image.</p>

<h2 id="csv-logger">CSV logger</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CsvLogger</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c1"># Sets up the csv-logger with the parameters and column names provided
</span>
    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="c1"># Adds a row to the (currently in-memory) csvfile
</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># Writes the in-memory csv file to a hard-drive csv file
</span></code></pre></div></div>
<p>The CSV-logger is an important part of running multiple experiments, while allowing after-the-fact data processing. Refer to the <a href="../output/#csv-logger">CSV logger output</a> for a detailed explanation of the exact formatting of the outputted CSV files.</p>

<p class="note">Although the <a href="https://pandas.pydata.org/"><code class="language-plaintext highlighter-rouge">pandas</code></a> library is a well known library to work with tables and CSV files, this class actually uses a list of CSV formatted strings instead of a <code class="language-plaintext highlighter-rouge">pandas</code> dataframe. This is done so since <code class="language-plaintext highlighter-rouge">pandas.append(row)</code> is a relatively expensive operation compared to <code class="language-plaintext highlighter-rouge">list.append(str)</code>, and appending to a dataframe would’ve be the only used feature of <code class="language-plaintext highlighter-rouge">pandas</code> (apart from the <code class="language-plaintext highlighter-rouge">_to_csv()</code> function).</p>

<h3 id="csvlogger-construction">CsvLogger construction</h3>
<p>The constructor of the <code class="language-plaintext highlighter-rouge">CsvLogger</code>, <code class="language-plaintext highlighter-rouge">CsvLogger.__init__()</code>, constructs a new instance of the <code class="language-plaintext highlighter-rouge">CsvLogger</code> class. During construction the parameters, such as the separator and separator replacement, for the logger are set. Using the provided columns names, the number of columns is determined and the header string is generated.</p>

<h3 id="add-row">Add row</h3>
<p>In this function a new row is added to the list of CSV formatted string. If \(R\) is the row to add, then \(R\) should be a list of objects \(r\in R\) such that \(\forall r\in R : str(r) \neq None\) and \(|R|=n\_cols\), where \(n\_cols\) represents the amount of columns of the final CSV file.</p>

<p>For each object \(r\in R\) it is checked if <code class="language-plaintext highlighter-rouge">str(r)</code> contains the separator character. If so, it is replaced by the separator replacement character. Then all processed strings are joined together using the separator character and the resulting string is appended to the list of formatted strings.</p>

<h3 id="write">Write</h3>
<p>The <code class="language-plaintext highlighter-rouge">write()</code> function writes the list of CSV formatted strings to a comma-separated values file. First the header string is added, then all the CSV formatted string are added to this file.</p>

<h1 id="utilities">Utilities</h1>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># exception.py
</span><span class="k">class</span> <span class="nc">InvalidArgumentError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MissingArgumentError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">InvalidParameterError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># util.py
</span><span class="k">def</span> <span class="nf">do_nothing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">dd_factory</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># recursive definition of defaultdict
</span>
<span class="k">def</span> <span class="nf">update_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">omit_new</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c1"># update dict-like d with key-value pairs 
</span>    <span class="c1"># in dict-like u
</span></code></pre></div></div>

<p>Two different utility files were created:</p>
<ul>
  <li><a href="https://github.com/Leander-van-Boven/D28-Tragedy_of_the_Commons/blob/master/cpr_simulation/exception.py"><code class="language-plaintext highlighter-rouge">exception.py</code></a> used for custom exception handling.</li>
  <li><a href="https://github.com/Leander-van-Boven/D28-Tragedy_of_the_Commons/blob/master/cpr_simulation/util.py"><code class="language-plaintext highlighter-rouge">util.py</code></a> contains some utilitarian methods that are used across the module.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">do_nothing()</code> does exactly nothing. This is used to remap some local print method to if that level of verbosity isn’t required.</li>
      <li><code class="language-plaintext highlighter-rouge">dd_factory()</code> is a recursive definition of a python <code class="language-plaintext highlighter-rouge">defaultdict</code> that returns a new <code class="language-plaintext highlighter-rouge">defaultdict</code> if a nonexistant key is specified. This property also holds for the nested <code class="language-plaintext highlighter-rouge">defaultdict</code>, which allows us to <code class="language-plaintext highlighter-rouge">dd['nest']['non']['existent']['keys']['into']['oblivion']</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">update_dict</code> is used to update dict-like <code class="language-plaintext highlighter-rouge">d</code> with the key-value pairs that exist in the dict-like <code class="language-plaintext highlighter-rouge">u</code>.</li>
    </ul>
  </li>
</ul>

<p>used to generate a default parameter dictionary (<code class="language-plaintext highlighter-rouge">dd_factory()</code>) and to update one dictionary with the values of another dictionary (<code class="language-plaintext highlighter-rouge">update_dict</code>).</p>

  

</article>

  
<footer class="content" role="contentinfo">
  <hr/>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/D28-Tragedy_of_the_Commons/LICENSE/">LICENSE</a>
      |
    
      
      <a class="heading flip-title" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">COOKIES POLICY</a>
      
    
    </small></nav>
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.0.5</span></small></p>
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg sidebar-overlay" style="background-color:rgb(79,177,186);background-image:url(/D28-Tragedy_of_the_Commons/assets/img/lake.jpg)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/D28-Tragedy_of_the_Commons/" tabindex="-1">
        <img src="/D28-Tragedy_of_the_Commons/assets/img/nemo_logo.png" class="avatar" alt="Tragedy of the Commons model Documentation" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/D28-Tragedy_of_the_Commons/"><h2 class="h1">Tragedy of the Commons model Documentation</h2></a>
    
    
      <p class="">
        Everything there is to know about the implementation of this awesome project. All in one place.

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/D28-Tragedy_of_the_Commons/pages/background/"
          class="sidebar-nav-item "
          
        >
          Background
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/D28-Tragedy_of_the_Commons/pages/architecture/"
          class="sidebar-nav-item "
          
        >
          Architecture
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/D28-Tragedy_of_the_Commons/pages/interaction/"
          class="sidebar-nav-item "
          
        >
          Interaction
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/D28-Tragedy_of_the_Commons/pages/parameters/"
          class="sidebar-nav-item "
          
        >
          Parameters
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/D28-Tragedy_of_the_Commons/pages/output/"
          class="sidebar-nav-item "
          
        >
          Output
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/Leander-van-Boven/D28-Tragedy_of_the_Commons" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var e=document.createElement("script");if(!("noModule"in e)&&"onbeforeload"in e){var t=!1;document.addEventListener("beforeload",function(n){if(n.target===e)t=!0;else if(!n.target.hasAttribute("nomodule")||!t)return;n.preventDefault()},!0),e.type="module",e.src=".",document.head.appendChild(e),e.remove()}}();
</script>
  <script src="/D28-Tragedy_of_the_Commons/assets/js/hydejack-9.0.5.js" type="module"></script>
  <script src="/D28-Tragedy_of_the_Commons/assets/js/LEGACY-hydejack-9.0.5.js" nomodule defer></script>
  

  

<!--<![endif]-->
  



<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_forward-template">
  <button id="_forward" class="forward nav-btn no-hover">
    <span class="sr-only">Forward</span>
    <span class="icon-arrow-right2"></span>
  </button>
</template>

  <template id="_back-template">
  <button id="_back" class="back nav-btn no-hover">
    <span class="sr-only">Back</span>
    <span class="icon-arrow-left2"></span>
  </button>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

</div>


</body>
</html>
